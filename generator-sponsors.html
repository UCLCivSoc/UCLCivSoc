<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sponsor Generator</title>
    <style>
        :root { 
            --bg: #121214;
            --surface: #1e1e24;
            --surface-hover: #272730;
            --border: #333;
            --primary: #00e676; /* Sponsor Green */
            --text: #e1e1e6; 
            --text-muted: #a8a8b3;
            --radius: 8px;
            --font-sans: 'Inter', -apple-system, sans-serif;
        }

        * { box-sizing: border-box; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: var(--font-sans); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        .top-bar { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: var(--surface); }
        .nav-left a { color: var(--text-muted); text-decoration: none; font-weight: 500; font-size: 0.9rem; }
        .nav-left a:hover { color: var(--text); }

        .container { max-width: 500px; margin: 50px auto; padding: 0 20px; }
        .glass-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 30px; }

        label { color: var(--text-muted); font-size: 0.75rem; font-weight: 700; text-transform: uppercase; margin-bottom: 6px; display: block; letter-spacing: 0.5px; }
        input { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 12px; border-radius: var(--radius); width: 100%; font-family: inherit; font-size: 0.9rem; margin-bottom: 20px; transition: 0.2s; }
        input:focus { border-color: var(--primary); }

        .upload-area { 
            border: 2px dashed #444; border-radius: 8px; padding: 30px; text-align: center; 
            margin-bottom: 20px; cursor: pointer; transition: 0.2s; background: rgba(0,0,0,0.2);
            display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px;
        }
        .upload-area:hover { border-color: var(--primary); background: rgba(255,255,255,0.02); }
        .upload-area p { margin: 0; color: var(--text-muted); font-size: 0.9rem; }
        
        .preview-img { max-width: 100%; max-height: 80px; margin-top: 10px; display: none; object-fit: contain; }
        
        .btn-primary { width: 100%; padding: 14px; background: var(--primary); color: #000; font-weight: 700; border: none; border-radius: var(--radius); cursor: pointer; font-size: 0.9rem; text-transform: uppercase; margin-top: 10px; transition: 0.2s; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; }

        #status-msg { margin-top: 20px; text-align: center; font-weight: bold; min-height: 1.2em; font-size: 0.9rem; }
        .success { color: #00e676; } .error { color: #ff4444; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="auth.js"></script>
</head>
<body>
    <div class="top-bar">
        <div class="nav-left"><a href="easygenerator.html">‚Üê Generator Hub</a></div>
        <div style="font-weight:700; letter-spacing:1px; color:#fff;">SPONSOR MANAGER</div>
        <button onclick="logout()" style="background:transparent;border:1px solid #444;color:#888;padding:5px 10px;border-radius:4px;cursor:pointer;">Logout</button>
    </div>

    <div class="container glass-panel">
        <label>Sponsor Name</label>
        <input type="text" id="s-name" placeholder="Company Name">

        <label>Website URL</label>
        <input type="text" id="s-url" placeholder="https://...">

        <label>Logo Upload</label>
        <div class="upload-area" onclick="document.getElementById('file-input').click()">
            <p>Click to select logo (PNG/SVG)</p>
            <img id="logo-preview" class="preview-img">
        </div>
        <input type="file" id="file-input" style="display:none" accept="image/*" onchange="handleFileSelect(this)">

        <button class="btn-primary" id="save-btn" onclick="saveSponsor()">Add Sponsor to Database</button>
        <div id="status-msg"></div>
    </div>

    <script>
        let db;
        checkAuth((user) => { db = firebase.firestore(); });
        let selectedFile = null;

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('logo-preview');
                    img.src = e.target.result; img.style.display = 'block';
                    document.querySelector('.upload-area p').style.display = 'none';
                }
                reader.readAsDataURL(selectedFile);
            }
        }

        async function saveSponsor() {
            const name = document.getElementById('s-name').value;
            const url = document.getElementById('s-url').value;
            const btn = document.getElementById('save-btn');
            const msg = document.getElementById('status-msg');

            if (!name || !url || !selectedFile) { msg.innerText = "Please fill all fields."; msg.className = "error"; return; }

            btn.disabled = true; btn.innerText = "UPLOADING..."; msg.innerText = "";

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('upload_preset', CIVSOC_CONFIG.cloudinary.uploadPreset);
                const cRes = await fetch(`https://api.cloudinary.com/v1_1/${CIVSOC_CONFIG.cloudinary.cloudName}/image/upload`, { method: 'POST', body: formData });
                const cData = await cRes.json();
                
                if (!cData.secure_url) throw new Error("Image upload failed");

                btn.innerText = "SAVING...";
                await db.collection("sponsors").add({ name: name, url: url, logo: cData.secure_url, createdAt: new Date().toISOString() });

                msg.innerText = "Sponsor added successfully!"; msg.className = "success";
                
                // Reset
                document.getElementById('s-name').value = '';
                document.getElementById('s-url').value = '';
                document.getElementById('logo-preview').src = '';
                document.getElementById('logo-preview').style.display = 'none';
                document.querySelector('.upload-area p').style.display = 'block';
                selectedFile = null;
                setTimeout(() => { btn.innerText = "Add Sponsor to Database"; btn.disabled = false; msg.innerText = ""; }, 3000);

            } catch (err) {
                console.error(err); msg.innerText = "Error: " + err.message; msg.className = "error";
                btn.innerText = "TRY AGAIN"; btn.disabled = false;
            }
        }
    </script>
</body>
</html>